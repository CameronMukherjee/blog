<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Percentage Based Routing in High Performance Distributed Systems &#183; ufu.dev</title>
<meta name=title content="Percentage Based Routing in High Performance Distributed Systems &#183; ufu.dev"><meta name=keywords content="systems design,distributed,high performance,"><link rel=canonical href=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/><link type=text/css rel=stylesheet href=/css/main.bundle.min.857ec6700dbdcae3e112eba9fc29e3aa948366934f76d502f60b6a3e436e12e2f10925d27f3032ad87f18cbcaddb981eca1fa59d74de83da90ade26f5faf75dd.css integrity="sha512-hX7GcA29yuPhEuup/CnjqpSDZpNPdtUC9gtqPkNuEuLxCSXSfzAyrYfxjLyt25geyh+lnXTeg9qQreJvX6913Q=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.6a4296a3ed9203be49ac203966fe6cd1e1a38a9313f4e36ab3a7483897f8e78106ef8cdfebfe8e02a55d125beec2f11d6eae1ef9ccfb1fcce310fa515d263add.js integrity="sha512-akKWo+2SA75JrCA5Zv5s0eGjipMT9ONqs6dIOJf454EG74zf6/6OAqVdElvuwvEdbq4e+cz7H8zjEPpRXSY63Q==" data-copy data-copied></script><script src=/js/zoom.min.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Percentage Based Routing in High Performance Distributed Systems"><meta property="og:description" content="Introduction # In today&rsquo;s dynamic digital landscape, efficient request routing is paramount for ensuring optimal performance and user experience."><meta property="og:type" content="article"><meta property="og:url" content="https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/"><meta property="og:image" content="https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/featured.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-16T14:11:46+01:00"><meta property="article:modified_time" content="2023-08-16T14:11:46+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/featured.jpg"><meta name=twitter:title content="Percentage Based Routing in High Performance Distributed Systems"><meta name=twitter:description content="Introduction # In today&rsquo;s dynamic digital landscape, efficient request routing is paramount for ensuring optimal performance and user experience."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog Posts","name":"Percentage Based Routing in High Performance Distributed Systems","headline":"Percentage Based Routing in High Performance Distributed Systems","abstract":"Introduction # In today\u0026rsquo;s dynamic digital landscape, efficient request routing is paramount for ensuring optimal performance and user experience.","inLanguage":"en","url":"https:\/\/ufu.dev\/posts\/percentage-based-routing-in-distributed-systems\/","author":{"@type":"Person","name":"Cameron Mukherjee"},"copyrightYear":"2023","dateCreated":"2023-08-16T14:11:46\u002b01:00","datePublished":"2023-08-16T14:11:46\u002b01:00","dateModified":"2023-08-16T14:11:46\u002b01:00","keywords":["systems design","distributed","high performance"],"mainEntityOfPage":"true","wordCount":"2193"}]</script><meta name=author content="Cameron Mukherjee"><link href=mailto:mukherjee.cameron@gmail.com rel=me><link href=https://github.com/cameronmukherjee rel=me><link href=https://gitlab.com/cameronmukherjee rel=me><link href=https://www.linkedin.com/in/cameron-mukherjee-72b676174/ rel=me><link href=https://twitter.com/ufu_dev rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EHQHVC1409"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EHQHVC1409")</script><meta name=theme-color><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js></script><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js></script><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js></script><script>const firebaseConfig={apiKey:"AIzaSyB_1NiKS8xhwsOWb9A7X-wdcixtjsIkArQ",authDomain:"AIzaSyB_1NiKS8xhwsOWb9A7X-wdcixtjsIkArQ",projectId:"ufu-dev",storageBucket:"ufu-dev.appspot.com",messagingSenderId:"632042208036",appId:"1:632042208036:web:b298f8620a75dc4cbd91b1",measurementId:"G-EHQHVC1409"};var app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(),auth=firebase.auth()</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">ufu.dev</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Blogs>Blog</p></a><a href=/tags/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Blogs>Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/posts/percentage-based-routing-in-distributed-systems/featured.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>ufu.dev</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Blog Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/percentage-based-routing-in-distributed-systems/>Percentage Based Routing in High Performance Distributed Systems</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Percentage Based Routing in High Performance Distributed Systems</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center">&lt;time datetime="2023-08-16 14:11:46 &amp;#43;0100 &amp;#43;0100">16 August 2023&lt;/time>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>2193 words&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span title="Reading time">11 mins&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>
&lt;span id="views_posts/percentage-based-routing-in-distributed-systems/index.md" title="views">0&lt;/span>
&lt;span class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
&lt;path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>
&lt;span id="likes_posts/percentage-based-routing-in-distributed-systems/index.md" title="likes">0&lt;/span>
&lt;span class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
&lt;path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>
&lt;button id="likes_button"
class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
onclick="process_article()">
&lt;span id="likes_button_heart" style="display:none" class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
&lt;path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;span id="likes_button_emtpty_heart" class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
&lt;path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;span id="likes_button_text">&amp;nbsp;Like&lt;/span>
&lt;/button>
&lt;/span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/systems-design/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">systems design
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/distributed/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">distributed
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/high-performance/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">high performance</span></span></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#problem-statement>Problem Statement</a></li><li><a href=#possible-solution---atomic-redis-counter>Possible Solution - Atomic Redis Counter:</a><ul><li><a href=#concerns-with-this-approach>Concerns with this approach:</a></li></ul></li><li><a href=#possible-solution---ring-buffer-with-service-discovery>Possible Solution - Ring Buffer with Service Discovery:</a><ul><li><a href=#we-start-with-an-array-of-100-values>We start with an array of 100 values</a></li><li><a href=#the-array-is-attached-to-itself-in-the-following-fashion-forming-a-ring>The array is attached to itself in the following fashion, forming a ring</a></li><li><a href=#we-can-now-plot-our-percentage-based-routing-into-the-ring-in-the-following-fashion>We can now plot our percentage based routing into the ring in the following fashion</a></li><li><a href=#plot-our-server-pointers-onto-the-ring>Plot our server pointers onto the ring:</a></li><li><a href=#how-do-i-use-this-in-my-implementation>How do I use this in my implementation?</a></li><li><a href=#what-about-scaling-up-and-down>What about scaling up and down?</a></li><li><a href=#advantages-of-this-approach>Advantages of this approach</a></li><li><a href=#concerns-with-this-approach-1>Concerns with this approach</a></li><li><a href=#future-improvement>Future Improvement</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#problem-statement>Problem Statement</a></li><li><a href=#possible-solution---atomic-redis-counter>Possible Solution - Atomic Redis Counter:</a><ul><li><a href=#concerns-with-this-approach>Concerns with this approach:</a></li></ul></li><li><a href=#possible-solution---ring-buffer-with-service-discovery>Possible Solution - Ring Buffer with Service Discovery:</a><ul><li><a href=#we-start-with-an-array-of-100-values>We start with an array of 100 values</a></li><li><a href=#the-array-is-attached-to-itself-in-the-following-fashion-forming-a-ring>The array is attached to itself in the following fashion, forming a ring</a></li><li><a href=#we-can-now-plot-our-percentage-based-routing-into-the-ring-in-the-following-fashion>We can now plot our percentage based routing into the ring in the following fashion</a></li><li><a href=#plot-our-server-pointers-onto-the-ring>Plot our server pointers onto the ring:</a></li><li><a href=#how-do-i-use-this-in-my-implementation>How do I use this in my implementation?</a></li><li><a href=#what-about-scaling-up-and-down>What about scaling up and down?</a></li><li><a href=#advantages-of-this-approach>Advantages of this approach</a></li><li><a href=#concerns-with-this-approach-1>Concerns with this approach</a></li><li><a href=#future-improvement>Future Improvement</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div id=introduction class=anchor></div><h2 class="relative group">Introduction
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#introduction aria-label=Anchor>#</a></span></h2><p>In today&rsquo;s dynamic digital landscape, efficient request routing is paramount for ensuring optimal performance and
user experience. As businesses grow and diversify their online services, the need for a more refined, percentage-based
request routing system becomes evident. Such a system can be instrumental in balancing payment requests, especially when
dealing with multiple payment providers that have varying cost structures. But how can we design a system that routes
thousands of requests per second based on predefined percentages without compromising on performance? Moreover,
how can we ensure that this system is scalable and distributed to meet the demands of a rapidly evolving digital
ecosystem? In this blog post, we delve deep into two potential solutions to this intriguing challenge:
the Atomic Redis Counter and the Ring Buffer with Service Discovery. Join us as we dissect each approach,
weighing their pros and cons, and provide insights into which might be the best fit for your specific needs.</p><div id=problem-statement class=anchor></div><h2 class="relative group">Problem Statement
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#problem-statement aria-label=Anchor>#</a></span></h2><p>We want the ability to route requests to different gateways based on a percentage.
This system does not need to be 100% accurate when routing requests.</p><p>Here is an example configuration:</p><table><thead><tr><th>Route</th><th>Percentage</th></tr></thead><tbody><tr><td>Twitter</td><td>50%</td></tr><tr><td>Google</td><td>20%</td></tr><tr><td>Facebook</td><td>30%</td></tr></tbody></table><p>In a real world situation this would most likely be used for percentage routing and balancing of payment requests,
certain payment providers charge more per request once a specific threshold is met. A percentage based load balancer
could prevent these thresholds from being met.</p><p>To help conceptualise the requirements we can say we have <strong>3000 requests per second</strong>, all of which need to be routed
based on this percentage.</p><p><strong>How can we effectively implement a system to ensure all requests are routed based on their percentage without impacting
performance while also ensuring the system is highly distributed and scalable?</strong></p><div id=possible-solution---atomic-redis-counter class=anchor></div><h2 class="relative group">Possible Solution - Atomic Redis Counter:
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#possible-solution---atomic-redis-counter aria-label=Anchor>#</a></span></h2><p>A potential answer to this question could be an atomic counter using Redis.</p><p>The counter would start at 1 and go to 100, as requests come in each service would lock the key / value pair in Redis,
read the value and update the counter.</p><p>The value would then determine which gateway to send the request to, for example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Increment the counter atomically</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>long</span><span class=w> </span><span class=n>counter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jedis</span><span class=p>.</span><span class=na>incr</span><span class=p>(</span><span class=s>&#34;request_counter&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// If counter exceeds 100, reset it to 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>counter</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>100</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jedis</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;request_counter&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>counter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Determine the gateway based on the counter value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>counter</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>50</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;Twitter&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>counter</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>70</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 50 + 20 = 70</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;Google&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;Facebook&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>  
</span></span></span></code></pre></div><p>While this does work, it does come with some concerns, especially seeming as our requirements requiring 3000
requests per second. Below I have listed a handful of issues with this design.</p><div id=concerns-with-this-approach class=anchor></div><h3 class="relative group">Concerns with this approach:
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#concerns-with-this-approach aria-label=Anchor>#</a></span></h3><ol><li><strong>Scalability:</strong><ol><li><strong>Single Point of Bottleneck:</strong> Since all requests need to interact with the Redis instance to get the counter value, it can become a bottleneck when there&rsquo;s a high volume of requests. Even though Redis is fast, the sheer number of operations (increment and possibly reset) can strain the system.</li><li><strong>Network Latency:</strong> If the application instances are not co-located with the Redis instance, network latency can introduce delays in request routing.</li></ol></li><li><strong>Possibility to block other instances / servers:</strong><ol><li><strong>Lock Contention:</strong> If multiple instances try to reset the counter simultaneously after it exceeds 100, there can be contention. While Redis operations like INCR are atomic, the check-and-set pattern (checking if the counter is over 100 and then resetting it) is not inherently atomic and can lead to race conditions.</li><li><strong>Blocking Delays:</strong> If one instance takes longer to interact with Redis (due to network issues, for instance), it might delay other instances from accessing the counter, leading to uneven distribution or potential timeouts.</li></ol></li><li><strong>Possible Cascading Failures:</strong><ol><li><strong>Cascade Failures:</strong> If the Redis instance becomes unresponsive or slow (due to high CPU usage, memory issues, etc.), it can cause the application instances to become slow or unresponsive as they wait for Redis. This can lead to a cascading failure where one component&rsquo;s failure leads to system-wide degradation or outage.</li><li><strong>Single Point of Failure:</strong> If the Redis instance goes down, the entire request routing mechanism breaks. Even with Redis replication, there&rsquo;s a period of time during failover where the system might not function as expected.</li><li><strong>Thread Blocking:</strong> Since Redis is single-threaded, long-running commands or a large number of simultaneous commands can block the server, causing delays. If our application instance is also single-threaded, it can get blocked waiting for Redis, leading to potential deadlocks or severe performance degradation.</li></ol></li></ol><div id=possible-solution---ring-buffer-with-service-discovery class=anchor></div><h2 class="relative group">Possible Solution - Ring Buffer with Service Discovery:
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#possible-solution---ring-buffer-with-service-discovery aria-label=Anchor>#</a></span></h2><p>The code shown here in snippets can be found in this <a href=https://gist.github.com/CameronMukherjee/2113089096a5d17e1dab2e5c36947a4b target=_blank>GitHub Gist</a>.</p><p>A more scalable solution to this issue (with additional overhead) would be implementing service discovery for each node
and maintain a local copy of a Ring Buffer.</p><p>The ring buffer would be 100 elements long, representing the percentage distribution for routing.</p><div id=we-start-with-an-array-of-100-values class=anchor></div><h3 class="relative group">We start with an array of 100 values
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#we-start-with-an-array-of-100-values aria-label=Anchor>#</a></span></h3><p>0 to 99 - this will be used to represent the percentage routing<figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img.png alt=img.png></figure></p><div id=the-array-is-attached-to-itself-in-the-following-fashion-forming-a-ring class=anchor></div><h3 class="relative group">The array is attached to itself in the following fashion, forming a ring
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-array-is-attached-to-itself-in-the-following-fashion-forming-a-ring aria-label=Anchor>#</a></span></h3><p>This is commonly known as a ring buffer, circular buffer or cyclic buffer:<figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img_1.png alt=img_1.png></figure></p><div id=we-can-now-plot-our-percentage-based-routing-into-the-ring-in-the-following-fashion class=anchor></div><h3 class="relative group">We can now plot our percentage based routing into the ring in the following fashion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#we-can-now-plot-our-percentage-based-routing-into-the-ring-in-the-following-fashion aria-label=Anchor>#</a></span></h3><p><figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img_2.png alt=img_2.png></figure></p><p>This is an example of what the underlying array would look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 50 Twitters, 30 Facebooks, 20 Googles</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>twitter</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>facebook</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>,</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>google</span><span class=o>.</span><span class=n>com</span><span class=p>]</span>
</span></span></code></pre></div><div id=plot-our-server-pointers-onto-the-ring class=anchor></div><h3 class="relative group">Plot our server pointers onto the ring:
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#plot-our-server-pointers-onto-the-ring aria-label=Anchor>#</a></span></h3><p>We can now create our pointers for each server / instance, and balance them across the ring buffer.
We would utilise a distribution coordination tool like Apache ZooKeeper for this part. Apache ZooKeeper will give us
the ability to find out how many instances of <em>this</em> server is online, allowing us to distribute tasks across the instances.<figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img_3.png alt=img_3.png></figure></p><p>Figuring out the pointer location is very easy and looks something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateRingPointer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>partitionSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>getInstancesAvailable</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getInstanceNumber</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>partitionSize</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Instance pointer has been changed to: [{}]&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Each service would be responsible for resolving their own pointer.</p><div id=how-do-i-use-this-in-my-implementation class=anchor></div><h3 class="relative group">How do I use this in my implementation?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#how-do-i-use-this-in-my-implementation aria-label=Anchor>#</a></span></h3><p><strong>Important Note:</strong> When a request hits our service we first make sure the requests are load balanced via Round Robin, any non-sequential / cyclic
load balancing strategy will result with this not working, for example hash based routing, or sticky routing.</p><ol><li>Firstly, our server instance registers with Apache ZooKeeper and finds out where there pointer is via the following code:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getInstancesAvailable</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=p>,</span><span class=w> </span><span class=n>KeeperException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>activeInstances</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>zooKeeper</span><span class=p>.</span><span class=na>getChildren</span><span class=p>(</span><span class=n>serverInstancePath</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>activeInstances</span><span class=p>.</span><span class=na>size</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getInstanceNumber</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=p>,</span><span class=w> </span><span class=n>KeeperException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>activeInstances</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>zooKeeper</span><span class=p>.</span><span class=na>getChildren</span><span class=p>(</span><span class=n>serverInstancePath</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>activeInstances</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=n>instanceName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateRingPointer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>partitionSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>getInstancesAvailable</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getInstanceNumber</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>partitionSize</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Instance pointer has been changed to: [{}]&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>When a new request lands on our service we can convert our configuration to the ring buffer (code omitted as it&rsquo;s highly dependent on your domain objects) - please make sure it builds in the same order for all instances (have some sorting involved).</li><li>We fetch the pointer (which has been previously updated by our <code>updateRingPointer()</code> function):</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getAndIncrementPointer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>currentPointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>currentPointer</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>100</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>pointer</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>currentPointer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>We can then index into the array at that value and route the request based on the value.</li><li>If an error occurs you can decrement the pointer by 1 (if value is at 0 then return 100) to ensure you maintain a consistent balance between all nodes.</li></ol><p>Here is what this looks like across 4 different services:<figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img_5.png alt=img_5.png></figure></p><ul><li>The first request lands on <code>Instance 0</code> and moves the pointer forward by 1.</li><li>The second request lands on <code>Instance 1</code> and moves the pointer forward by 1.</li><li>The third request lands on <code>Instance 2</code> and moves the pointer forward by 1.</li><li>The fourth request lands on <code>Instance 3</code> and moves the pointer forward by 1.</li><li>The fifth request lands on <code>Instance 0</code> and moves the pointer forward by 1.</li></ul><p><strong>When any pointer reaches 100 they are reset to 0.</strong></p><div id=what-about-scaling-up-and-down class=anchor></div><h3 class="relative group">What about scaling up and down?
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#what-about-scaling-up-and-down aria-label=Anchor>#</a></span></h3><p>Instances will receive an event from Apache ZooKeeper stating that children have changed, allowing you to re-run the
<code>updateRingPointer()</code> function provided above, providing the new pointer location.</p><p>So, what if 4 instances are now available (we&rsquo;ve scaled up)?<figure><img class="my-0 rounded-md" src=/posts/percentage-based-routing-in-distributed-systems/img_4.png alt=img_4.png></figure>The ring buffer pointers would be updated to the following,
as you can see, all pointers have been moved evenly apart to ensure a correct balance when receiving the next set of
requests.</p><p>Here are some examples of what the pointers would look like based on how many instances are available:</p><p><strong>4 Instances:</strong></p><table><thead><tr><th>Instance Number</th><th>Pointer</th></tr></thead><tbody><tr><td>0</td><td>0</td></tr><tr><td>1</td><td>25</td></tr><tr><td>2</td><td>50</td></tr><tr><td>3</td><td>75</td></tr></tbody></table><p><strong>3 Instances:</strong></p><table><thead><tr><th>Instance Number</th><th>Pointer</th></tr></thead><tbody><tr><td>0</td><td>0</td></tr><tr><td>1</td><td>33</td></tr><tr><td>2</td><td>66</td></tr></tbody></table><p>Keep in mind, everytime an instance is added or removed these pointers are reset to a default position to ensure
equal balancing.
For example, this means if <code>Instance 0</code> has moved forward 10 paces but a new instance comes online, the pointer is reset
to 0 - meaning the next 10 requests will be duplicated (based on current implementation - something I would like to fix
moving forward).</p><div id=advantages-of-this-approach class=anchor></div><h3 class="relative group">Advantages of this approach
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#advantages-of-this-approach aria-label=Anchor>#</a></span></h3><ol><li>No usage of Redis to maintain a counter, removing the possibility of thread deprivation or single point of failure.</li><li>Low memory footprint if we use String values in the ring buffer (in Java, the String pool will be used for storing each gateway config).</li><li>Faster lookup as array has already been build / cached on the instance (O(1) look up).</li><li>Highly scalable as new nodes can join and leave the cluster without introducing any locks on shared state.</li></ol><div id=concerns-with-this-approach-1 class=anchor></div><h3 class="relative group">Concerns with this approach
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#concerns-with-this-approach-1 aria-label=Anchor>#</a></span></h3><ol><li>If nodes are added and removed from the cluster frequently, this will not work effectively, re-balancing will cause all pointers to be rebalanced and thus reset to a default equally partitioned state.</li><li>Additional code complexity and new service introduction (Apache ZooKeeper).</li><li>Overhead from building the Ring Buffer (can be cached within the instance to lower the overhead - this comes with its own downfalls though).</li></ol><div id=future-improvement class=anchor></div><h3 class="relative group">Future Improvement
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#future-improvement aria-label=Anchor>#</a></span></h3><ol><li>Instead of maintaining one pointer per service, we can maintain multiple (acting as virtual pointers), which allows for a much more even distribution.</li><li>Ability to add and remove nodes without moving current in use pointers - allowing for re-balancing to not affect the currently processed distribution.</li></ol><div id=conclusion class=anchor></div><h2 class="relative group">Conclusion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>Software architecture is a vast and intricate domain, where one-size-fits-all solutions are a rarity. The challenge of routing requests based on percentages, particularly at high volumes, epitomizes this complexity. In our exploration, we delved into two promising solutions: the Atomic Redis Counter and the Ring Buffer with Service Discovery.</p><p>The Atomic Redis Counter stands out for its straightforwardness. It&rsquo;s a solution that can be quickly implemented and understood. However, its simplicity can be a double-edged sword when scalability comes into play. For systems that don&rsquo;t anticipate a surge in traffic or those in their nascent stages, this might be an ideal choice.</p><p>On the other hand, the Ring Buffer with Service Discovery is a testament to the power of modern distributed systems. While it demands a deeper understanding and more intricate setup, it shines in scenarios where scalability and distributed processing are paramount. Systems that are poised for growth or those already experiencing high traffic volumes might find this approach more in line with their needs.</p><p>Yet, it&rsquo;s crucial to remember that the world of software is teeming with possibilities. The strategies discussed here are but a drop in the ocean of potential solutions. The right approach hinges heavily on the unique challenges and requirements of your system. It&rsquo;s not about finding the &ldquo;best&rdquo; solution in a general sense, but rather the most fitting one for your specific context.</p><p>Moreover, the technological landscape is in a state of perpetual flux. Today&rsquo;s cutting-edge solution might become tomorrow&rsquo;s legacy system. As architects and developers, it&rsquo;s our responsibility to stay abreast of emerging tools and techniques. Regular evaluations, performance monitoring, and a willingness to pivot when necessary are essential.</p><p>In wrapping up, percentage-based request routing, though a nuanced problem, offers a myriad of solutions. The essence lies in comprehending your system&rsquo;s intricacies, forecasting potential hurdles, and opting for a solution that strikes the right chord between simplicity, scalability, and efficacy. In the realm of software, the optimal solution is invariably tailored to your unique challenges and aspirations.</p><p><a href=https://gist.github.com/CameronMukherjee/2113089096a5d17e1dab2e5c36947a4b target=_blank>GitHub Gist</a> related to this project.</p></br></br></div><script>var oid="views_posts/percentage-based-routing-in-distributed-systems/index.md",oid_likes="likes_posts/percentage-based-routing-in-distributed-systems/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Cameron Mukherjee" src=/img/author_hu0bf78d60e280294aca83f5c056db49b3_20425_192x192_fill_q75_box_center.jpeg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Cameron Mukherjee</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Technical Lead, Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:mukherjee.cameron@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/cameronmukherjee target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://gitlab.com/cameronmukherjee target=_blank aria-label=Gitlab rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M510.486 284.482l-27.262-83.963c.012.038.016.077.028.115-.013-.044-.021-.088-.033-.132v-.01L429.1 33.871a21.328 21.328.0 00-20.445-14.6A21.038 21.038.0 00388.466 34L337.094 192.154H175L123.533 33.989A21.033 21.033.0 00103.35 19.274h-.113A21.467 21.467.0 0082.86 34L28.888 200.475l-.008.021v0c-.013.042-.019.084-.033.127.012-.038.017-.077.029-.115L1.514 284.482a30.6 30.6.0 0011.117 34.283L248.893 490.427c.035.026.074.041.109.067.1.072.2.146.3.214-.1-.065-.187-.136-.282-.2.015.012.033.02.05.031s.027.015.041.024h.006a11.992 11.992.0 001.137.7c.054.03.1.068.157.1.033.016.064.038.1.054s.053.02.077.032.038.015.056.023c.044.021.092.034.136.057.205.1.421.178.633.264.2.082.389.177.592.248l.025.011c.034.012.064.028.1.04s.083.032.125.046l.05.012c.053.016.11.024.163.039.019.006.042.009.063.015.284.086.579.148.872.213.115.026.225.062.341.083.017.0.032.009.05.012.038.008.073.021.112.027.062.011.122.031.186.04.049.007.1.0.151.012h.033a11.918 11.918.0 001.7.136h.019a11.971 11.971.0 001.7-.136h.033c.05-.008.1.0.153-.012s.124-.029.187-.04c.038-.006.073-.019.11-.027.017.0.032-.009.049-.012.118-.023.231-.059.349-.084.288-.064.578-.126.861-.21.019-.006.039-.008.059-.014.055-.017.113-.024.169-.041.016-.006.035-.007.051-.012.044-.013.086-.032.129-.047s.063-.028.1-.041l.026-.01c.214-.076.417-.175.627-.261s.394-.154.584-.245c.047-.023.1-.036.142-.059.018-.009.04-.015.058-.024s.053-.02.078-.033.068-.04.1-.056c.056-.028.106-.069.161-.1a12.341 12.341.0 001.132-.695c.029-.02.062-.035.092-.056.008-.006.017-.009.024-.015.035-.026.076-.043.11-.068l236.3-171.666A30.6 30.6.0 00510.486 284.482zM408.8 49.48l46.342 142.674H362.46zm-305.6.0 46.428 142.675H56.948zM26.817 299.251a6.526 6.526.0 01-2.361-7.308l20.34-62.42L193.835 420.6zm38.245-82.972h92.411L223.354 419.22zm183.416 273.83c-.047-.038-.092-.079-.138-.118-.009-.008-.018-.018-.028-.026-.091-.075-.18-.152-.268-.231-.172-.15-.341-.3-.5-.462.014.012.029.022.043.035l.055.046a12.191 12.191.0 001.091.929l.012.011c.018.013.033.03.051.045C248.689 490.263 248.58 490.19 248.478 490.109zm7.514-48.482L217.226 322.21 182.839 216.279H329.253zm7.935 48.107c-.091.079-.178.157-.27.233l-.032.028c-.047.038-.091.079-.136.117-.1.08-.209.152-.313.229.018-.013.033-.032.053-.044l.009-.009a11.69 11.69.0 001.086-.926c.014-.013.03-.024.044-.036s.038-.03.054-.047C264.262 489.435 264.1 489.586 263.927 489.734zm90.7-273.455h92.4l-18.91 24.23-139.468 178.7zm130.567 82.967L318.2 420.563 467.284 229.538l20.258 62.393A6.528 6.528.0 01485.189 299.246z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/cameron-mukherjee-72b676174/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/ufu_dev target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;text=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;resubmit=true&amp;title=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;description=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;quote=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;subject=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;resubmit=true&amp;title=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://ufu.dev/posts/percentage-based-routing-in-distributed-systems/&amp;resubmit=true&amp;title=Percentage%20Based%20Routing%20in%20High%20Performance%20Distributed%20Systems" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/posts/308-the-permanent-redirect-to-your-next-software-job/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/308-the-permanent-redirect-to-your-next-software-job/featured.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/308-the-permanent-redirect-to-your-next-software-job/>308: The Permanent Redirect to Your Next Software Job</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center">&lt;time datetime="2023-06-16 17:42:07 &amp;#43;0100 &amp;#43;0100">16 June 2023&lt;/time>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>3220 words&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span title="Reading time">16 mins&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>
&lt;span id="views_posts/308-the-permanent-redirect-to-your-next-software-job/index.md" title="views">0&lt;/span>
&lt;span class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
&lt;path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;/span>&lt;span class="px-2 text-primary-500">&amp;middot;&lt;/span>&lt;span>
&lt;span id="likes_posts/308-the-permanent-redirect-to-your-next-software-job/index.md" title="likes">0&lt;/span>
&lt;span class="inline-block align-text-bottom">
&lt;span class="relative block icon">
&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
&lt;path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/>&lt;/svg>
&lt;/span>
&lt;/span>
&lt;/span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/market/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">market
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/guide/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">guide</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/308-the-permanent-redirect-to-your-next-software-job/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">308: The Permanent Redirect to Your Next Software Job</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-06-16 17:42:07 +0100 +0100">16 June 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/breaking-monoliths/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Breaking Monoliths for Business Velocity</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-12-03 13:25:07 +0100 +0100">3 December 2023</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Cameron Mukherjee</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://ufu.dev style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>